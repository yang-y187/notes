职场与学校不同

- **自驱力，主动性**，定计划，制定中短期计划（可以找导师订）。深挖一个或两个小方向（）。对其他的方向熟悉。
- 不能被业务需求裹挟
- 熟悉一个需求怎么出现



先列出问题，等开会的时候或者和导师约个时间来问。



# 学习

- thrift
  - thrift是一个**跨语言**，的rpc框架。使用中间语言IDL来转换请求。
    thrift最大的优点就是跨语言。
  - ![image-20220526104728594](%E5%AE%9E%E4%B9%A0.assets/image-20220526104728594.png)
  - **为什么使用IDL？**
    - 因为thrift是跨语言的，支持多语言的转换，所以自己构建了一种语言，来处理。
  - **讲讲IDL数据结构？**
    - 数据结构选择所有语言有支持的部分，比如说：基本数据类型为有符号的，java支持无符号数，我猜测是thrift支持的语言可能有的只支持有符号数。
  - **RPC与普通http协议区别：**
    - HTTP协议在应用层完成的，但有时效率并不高效；
    - RPC可以不依赖于应用层协议，可以直接基于TCP进行远程调用，在传输层中即可完成通信，因此更适于某些对效率要求更高的场景。



# MTThrift

- thrift都是service层之间的调用。与controller层无关
- controller层的配置都设置在网关，直接调用service。





# ElasticSearch

分布式的开源搜索和分析引擎。

- 为什么不使用MySQL进行搜索？
  - MySQL主要功能是数据的持久化和管理。对海量数据的搜索分析，Es更专业。
  - MySQL 本身不支持全文搜索，只有模糊查询，而且是全表扫描，查询效率低下。
  - MySQL 对于复杂条件查询的支持并不好，MySQL 最多使用一个条件涉及的索引来过滤，若过滤条件为多个字段，且都有索引，那MySQL只能选择索引进行使用，其他字段当做普通过滤条件。

## 概念

动名词对应

index（索引）

| Es               | MySQL                                              |
| :--------------- | -------------------------------------------------- |
| Index(索引)      | 动词：MySQL中的insert<br />名词：MySQL中的Database |
| Type（类型）     | 表                                                 |
| Document（文档） | 表中的内容（JSON格式）                             |

![image-20220526171436588](%E5%AE%9E%E4%B9%A0.assets/image-20220526171436588.png)



**倒排索引**

1. 将存储的内容进行分词
2. 每个词，可能有多条记录对应。
3. 检索时：会将要检索的内容也进行分词，只要有一个分词与es存储的词对应，则可以搜索出该词所有记录。顺序方面，对应的词越多，则顺序越靠前
4. 相关性分析：若对应的词个数相同，则记录内容总词数越少，顺序越靠前





![image-20220526184755934](%E5%AE%9E%E4%B9%A0.assets/image-20220526184755934.png)

使用kibana来访问es，类似SQLyog访问MySQL

## 初步

1，_ _ cat

GET /_cat/nodes：查看所有节点
GET /_cat/health：查看 es 健康状况
GET /_cat/master：查看主节点
GET /_cat/indices：查看所有索引 show databases;

2，索引一个文档（保存一个记录）

http://192.168.56.10:5601/app/kibana  在kibana网址进行检索。

## 1，基本语法格式

```elm
GET /bank/_search   // 查询操作
{
  "query": {   // 查询所有
    "match_all": {}
  },
  "sort": [   // 排序操作
    {
      "account_number": {
        "order": "desc"
      }
    }
  ]
}
```

响应结果

```
响应结果解释：
took - Elasticsearch 执行搜索的时间（毫秒）
time_out - 告诉我们搜索是否超时
_shards - 告诉我们多少个分片被搜索了，以及统计了成功/失败的搜索分片
hits - 搜索结果
hits.total - 搜索结果
hits.hits - 实际的搜索结果数组（默认为前 10 的文档）
sort - 结果的排序 key（键）（没有则按 score 排序）
score 和 max_score –相关性得分和最高得分（全文检索用）
```

Elasticsearch 提供了一个可以执行查询的 Json 风格的 DSL（domain-specific language 领域特定语言）。这个被称为 Query DSL。该查询语言非常全面。

- 查询语句经典结构

{
	QUERY_NAME: {      // 查询字段
			ARGUMENT: VALUE,   // 字段名  ，操作
			ARGUMENT: VALUE,...
	}
}

-  如果是针对某个字段，那么它的结构如下：

{
	QUERY_NAME: {    // 查询字段 
		FIELD_NAME: {   // 查询范围
			ARGUMENT: VALUE,
			ARGUMENT: VALUE,...
		}
	}
}

```elm
GET /bank/_search
{
  "query": {
    "match_all": {}
  },
  "sort": [
    {
      "balance": {
        "order": "desc"
      }
    }
  ],
  "from": 0,
  "size": 20
}
```

- query：定义如何查询
  - match_all 查询类型，all表明查询所有，es中多种查询方式
- 与query并列的操作还有 sort 排序（可以多字段排序），from起始位置 ，size查询大小

## 2，返回部分字段

默认查询数据返回符合该条件的文档的所有内容， `_source`可以指定返回的内容。与query，sort，from同级

```elm
GET /bank/_search
{
  "query": {
    "match_all": {}
  },
  "sort": [
    {
      "balance": {
        "order": "desc"
      }
    }
  ],
  "from": 0,
  "size": 20,
  "_source": ["age","balance"]
}
```

## 3 ，match【匹配查询】

- 精确查询（基本类型（非字符串）是精确匹配）

  - ```elm
    GET /bank/_search
    {
      "query": {
        "match": {
          "age":20
        }
      }
    }
    ```

- 模糊查询 （字符串类型是模糊查询，全文检索）

  - ```elm
    GET /bank/_search
    {
      "query": {
        "match": {
          "address": "Mill"
        }
      }
    }
    ```

  - **模糊查询是全文检索，会按评分进行查询排序，对检索条件进行分词匹配**。即match当查询字符串类型的时候，会进行全文 检索，并记录每条记录的相关性得分。输出时排序。

- 多词的模糊匹配

  - ```elm
    GET bank/_search
    {
      "query": {
        "match": {
          "address": "mill road"
        }
      }
    }
    ```

  - 查询时，会首先将条件进行分词。然后会对分词`road`  ，分词  `mill`  和分词 `road mill`的所有记录进行相关性得分。

## 4，match_phrase 【短语匹配】

由于多词的模糊 匹配，若我们需要将多词作为一个整体查询，而不将它分词。所以进行短语匹配

```elm
GET bank/_search
{
  "query": {
    "match_phrase": {
      "address": "mill road"
    }
  }
}
```

## 5，multi_match 【多字段匹配】

可能在查询时，可以选择多个字段 匹配该条件。

```elm
## 条件是：查询在address或city中进行模糊匹配。
GET bank/_search
{
  "query": {
    "multi_match": {
      "query": "mill road",
      "fields": ["address","city"]
    }
  }
}
```

## 6，bool【复合查询】

可以合并其他查询语句，包括符合查询（符合语句之间可以相互嵌套）

- must：必须达到must列举的所有条件
- must_not:必须不是指定的情况
- should：最好达到should列举的条件，满足会增加相关性评分

```
GET bank/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "multi_match": {
            "query": "mill road",
            "fields": [
              "address",
              "city"
            ]
          }
        }
      ],
      "must_not": [
        {
          "match": {
            "age": 25
          }
        }
      ],
      "should": [
        {
          "match": {
            "email": ".com"
          }
        }
      ]
    }
  }
}
```

## 7，filter【结果过滤】

match可以分词匹配，然后进行相关性判断。所以，可以选择filter过滤。**不计算分数。**filter与must。must_not同级别。

```
GET bank/_search
{
  "query": {
    "bool": {
      "filter": [
        {
          "multi_match": {
            "query": "mill road",
            "fields": [
              "address",
              "city"
            ]
          }
        }
      ]
    }
  }
}
```

## 8，term匹配

term也是匹配某个属性的值。但建议全文检索（字符串）字段用match，因为涉及到全文检索，分词。若是其他字段，即精确匹配，则可以使用term。term不能完成全文检索，所以不能使用term进行全文检索



# Git

git 分支合并，冲突处理









## 一.Git分支的作用

在进行多人协作开发的时候，为了防止互相干扰，提高协同开发的体验，建议每个开发者都基于分支进行项目功能的开发。

![image-20220530105129416](%E5%AE%9E%E4%B9%A0.assets/image-20220530105129416.png)

## 二：master主分支

在初始化本地Git仓库的时候，Git默认已经帮我们创建了一个名字叫做master的分支。通常我们把这个master分支叫做主分支。

![image-20220530105239162](%E5%AE%9E%E4%B9%A0.assets/image-20220530105239162.png)

 **在实际工作中，master主分支的作用是:用来保存和记录整个项目已完成的功能代码。**
**因此，不允许程序员直接在master分支上修改代码，因为这样做的风险太高，容易导致整个项目崩溃，因此我们需要在自己负责开发的分支上进行开发**

## 三.功能分支 

由于程序员不能直接在master分支上进行功能的开发，所以就有了功能分支的概念。
功能分支指的是专门用来开发新功能的分支，它是临时从master主分支上分叉出来的，当新功能开发且测试完毕后，最终需要合并到master主分支上。

![image-20220530105445956](%E5%AE%9E%E4%B9%A0.assets/image-20220530105445956.png)



## 优选规范：

### 分支命名规范

**格式：feature/{需求issueId}/{简要描述}** 

- 例如：**feature/YIOFY-2020-6183419/addCityQuery 或 feature/YIOFY-6183419/addCityQuery 或  feature/6183419/addCityQuery**
- 注意：6183419为需求issueId
- 建议：在Ones系统需求中创建分支，需求issueId将自动填写于新分支名之中

## 分支创建流程

## **何时创建**

**需求流程进入到开发阶段且“待开发”、“开发中”状态创建分支**

![image-20220530105805116](%E5%AE%9E%E4%B9%A0.assets/image-20220530105805116.png)

## **在哪创建**

**进入需求详情 -- 分支 -- 点击“新建分支”**

![image-20220530105820804](%E5%AE%9E%E4%B9%A0.assets/image-20220530105820804.png)

## **分支信息**

**在新建分支弹窗，选择服务 -- 分支类型（feature）-- 描述，即可预览分支名称**

![image-20220530110005874](%E5%AE%9E%E4%B9%A0.assets/image-20220530110005874.png)

## **分支关联**

**创建后，分支自动关联到需求上，本地IDEA切换到以上分支即可开始编码**

![image-20220530110026831](%E5%AE%9E%E4%B9%A0.assets/image-20220530110026831.png)

### Idea 中切换git分支

右键git工程，进入git，选择`Branches`

![image-20220530110533836](%E5%AE%9E%E4%B9%A0.assets/image-20220530110533836.png)

# Maven 

Maven中，为什么不直接调用server而是使用client？

- 因为一个大项目是多个团队合作开发。需求也是分发给多个团队。而且需求直接可能相互调用。若是一个团队等待其他团队开发完才开发影响开发效率。所以先构建出client标准（需求规范，与java中的接口类似），不影响其他其他人的调用开发。
- 此外，降低了耦合，更加规范化。
- 

# 作战平台1.0

作战平台1.0

![image-20220520104352575](%E5%AE%9E%E4%B9%A0.assets/image-20220520104352575.png)



-  crm-battle-client     ->接口，代码规范
- crm-battle-common   ->公共部分，导包等信息
- crm-battle-core    ->   
-  crm-battle-server    ->作战平台的具体实现--真正的SpringBoot
   -  ![image-20220530142440279](%E5%AE%9E%E4%B9%A0.assets/image-20220530142440279.png)
   -  只有config配置文件夹和thrift调用文件夹
   -  thrift可以理解为service层。为其他微服务调用或者网络接口调用。














# 问题

## 5.18问题

- 下载了代码，但会有各种包导不进去。权限问题？..

## 5.19问题

- MySQL中分库分表后怎么查询，不同数据源呢，怎么查询数据呢

## 5.24问题

- broker与分区的关系，一个分区与Follower的关系，一个分区应该是一个broker叭，那follower呢，也是一个全新的broker吗？还是分区的broker，也保存了其他broker的数据作为其他broker的follower
  - 分区与副本的关系
    -  kafka 服务器只有 4 个节点，那么设置 kafka 的分区数大于服务器台数，在 kafka底层如何分配存储副本呢？
  - 一个broker可以是多个分区的Leader？，那这样做，分区不就变得没意义了吗？
- 消息队列的数据是有过期时间的吧，那怎么处理一直没被消费的数据？我看到作战平台每天都有通知，有一个消息未被消费
- offset干嘛用的？

## 5-25问题

- socket请求，监听接收，数据读取，数据写入，不是一个东西吗？IO多路复用，单独一个线程，监听所有请求

## 5-26问题

- Redis应用:
  - redis解决分布式的session问题，
  - 分布式锁
  - （并发度高的请求）秒杀，
  - Redis底层数据结构
  - 内存淘汰策略
  - Redis作为缓存，策略
  - Redis集群
- MDP还是不能用，我真的服了。

## 5-27问题

- thrift使用：thrift的调用时service层的调用，不经过controller层。

## 5-30问题

- 看到需求创建规范 ，**feature/{需求issueId}/{简要描述}** 。需要有需求id才行。我目前需求应该轮不到我，那我是怎么使用分支吗？使用自己的分支吗
- Maven中，为什么不直接调用server而是使用client？
  - 因为一个大项目是多个团队合作开发。需求也是分发给多个团队。而且需求直接可能相互调用。若是一个团队等待其他团队开发完才开发影响开发效率。所以先构建出client标准（需求规范，与java中的接口类似），不影响其他其他人的调用开发。
  - 此外，降低了耦合，更加规范化。
- thrift 方法不能嵌套































































































# 学习计划

Spring    3天

thrift     4天

kafka/mafka  2天    

es+git        2天

OCTO 服务治理         

cat 日志上报   （后置，要求不高）

Mttrace 分布式链路追踪   （后置，要求不高）

MySQL+MyBatis   2天

Redis    2天





1、spring/mtthrift/kafka/es 会用，基本原理       

2、cat/mttrace/databus/rhino 了解 

​			databus：监听数据文件，

​			rhino：限流， 

3、mybatis/redis/mysql















